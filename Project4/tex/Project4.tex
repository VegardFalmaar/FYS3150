\documentclass[reprint, english,notitlepage,nofootinbib]{revtex4-1}  % defines the basic parameters of the document
% if you want a single-column, remove reprint

% allows special characters (including æøå)
\usepackage[utf8]{inputenc}
%\usepackage [norsk]{babel} %if you write norwegian
\usepackage[english]{babel}  %if you write english


%% note that you may need to download some of these packages manually, it depends on your setup.
%% I recommend downloading TeXMaker, because it includes a large library of the most common packages.

\usepackage{physics,amssymb}  % mathematical symbols (physics imports amsmath)
\usepackage{graphicx}         % include graphics such as plots
\usepackage{xcolor}           % set colors
\usepackage{hyperref}         % automagic cross-referencing (this is GODLIKE)
\usepackage{tikz}             % draw figures manually
\usepackage{listings}         % display code
\usepackage{subfigure}        % imports a lot of cool and useful figure commands
\usepackage{verbatim}
\usepackage{adjustbox}


% defines the color of hyperref objects
% Blending two colors:  blue!80!black  =  80% blue and 20% black
\hypersetup{ % this is just my personal choice, feel free to change things
    colorlinks,
    linkcolor={red!50!black},
    citecolor={blue!50!black},
    urlcolor={blue!80!black}}

%% Defines the style of the programming listing
%% This is actually my personal template, go ahead and change stuff if you want
\lstset{ %
	inputpath=,
	backgroundcolor=\color{white!88!black},
	basicstyle={\ttfamily\scriptsize},
	commentstyle=\color{magenta},
	language=Python,
	morekeywords={True,False},
	tabsize=4,
	stringstyle=\color{green!55!black},
	frame=single,
	keywordstyle=\color{blue},
	showstringspaces=false,
	columns=fullflexible,
	keepspaces=true}

\newcommand\numberthis{\addtocounter{equation}{1}\tag{\theequation}}
\newcommand{\ihat}{\boldsymbol{\hat{\textbf{\i}}}}
\newcommand{\jhat}{\boldsymbol{\hat{\textbf{\j}}}}
\newcommand{\khat}{\boldsymbol{\hat{\textbf{k}}}}
\newcommand{\del}[1]{\textbf{#1)}}
\newcommand{\svar}[1]{\underline{\underline{{#1}}}}
\newcommand{\vc}[1]{\mathbf{#1}}

\graphicspath{{../output/}} % search for figures in this dir



\begin{document}


\begin{titlepage}
	\begin{center}
	\textbf{Studies of phase transitions in magnetic systems}

	\vspace{0.2cm}
	Vegard Falmår and Sigurd Sørlie Rustad

	\vspace{0.5cm}
	\includegraphics[scale=0.5]{../../pictures/UIO}
	\vspace{0.8cm}

	University of Oslo\\
	Norway\\
	\today	\\
	\end{center}
	\tableofcontents
	\clearpage
\end{titlepage}

\begin{abstract}

\end{abstract}
\maketitle                              % creates the title


\section{Introduction}

For our studies we have used c++ for heavy computation, python for visualization and bash for automation. All the code along with instructions on how to run it, can be cloned from our GitHub repository here\footnote{github.com/sigurdru/FYS3150/tree/master/Project3}.

\section{Theory}

\subsection*{Statistical terms}
In this report we are going to use some basic statistical terms and expressions. For those not familiar with terms like standard deviation and mean value, they are covered below.

The expectation value or mean value, often written as $\left<A\right>$, is the sum of all values $A_i$, divided by the total number $N$ of values it can have:
\begin{equation*}
	\left< A \right> = \frac{1}{N}\sum_{i}^{N}A_i
\end{equation*}
However, when given a probability distribution $P_i$, which describes the probability of having outcome $A_i$, one can also find the expectation value through
\begin{equation*}
	\left<A\right> = \sum_{i}^{N}A_iP_i.
\end{equation*} 

Variance or standard deviation ($\sigma_A$), is a measurement of the variation in a set of data $A_i$. The mathematical expression is given as
\begin{equation*}
	\sigma_A = \sqrt{\frac{1}{N-1} \sum_{i}^{N} (A_i - \left<A\right>)^2} = \sqrt{\left<A^2\right> - \left<A\right>^2},
\end{equation*} 
where $N$ is the total number of outcomes and $\left<A\right>$ is the expectation value of $A_i$.

\subsection*{Canonical ensemble}
The probability of finding a system in a given microstate is found through the canonical ensemble, given by equation \eqref{eq:canonical_ensemble} (see \cite{lectures2015} chapter 13.2.2).
\begin{equation}
	\label{eq:canonical_ensemble}
	P_i(\beta) = \frac{\exp(-\beta E_i)}{Z},\ \ \beta = \frac{1}{k_BT}
\end{equation}
Here $P_i(\beta)$ is the probability of finding the system with energy $E_i$ and temperature $T$ in Kelvin. $k_B$ is Boltzmann constant and $Z$ the partition function given by
\begin{equation}
	\label{eq:partition_function}
	Z = \sum_{i = 1}^{M}\exp(-\beta E_i).
\end{equation}
Where $M$ is the total number of microstates.

The canonical ensemble and partition function is usually hard to find, however, when obtained we can use them to find many useful relations. Below we list the expressions (without derivation) we need will need in the report. Everything is from \cite{lectures2015} chapter 13.2.2.

The mean energy $\left<E\right>$ given as
\begin{equation}
	\label{eq:expected_energy}
	\left<E\right> = \frac{1}{Z} \sum_{i=1}^{M}E_i\exp(-\beta E_i),
\end{equation}
and the mean square energy ($\left<E^2\right>$) is calculated by
\begin{equation}
	\label{eq:expected_energy_sq}
	\left<E^2\right> = \frac{1}{Z} \sum_{i=1}^{M}E_i^2\exp(-\beta E_i).
\end{equation}
Mean absolute value of the magnetic moment $\left<|M|\right>$
\begin{equation}
	\label{eq:expected_magnetic_moment}
	\left<|M|\right> = \frac{1}{Z} \sum_{i=1}^{M}|M_i|\exp(-\beta E_i),
\end{equation}
and mean square magnetic moment ($\left<M^2\right>$) by
\begin{equation}
\label{eq:expected_magnetic_moment_sq}
\left<M^2\right> = \frac{1}{Z} \sum_{i=1}^{M}M_i^2\exp(-\beta E_i).
\end{equation}
With this we can also find the susceptibility $\chi$
\begin{equation}
	\label{eq:magnetic_susceptibility}
	\chi = \beta \sigma_M, \ \ \sigma_M = \sqrt{\left<M^2\right> - \left<|M|\right>}
\end{equation}
Where $\sigma_M$ is the variance of $|M|$. Specific heat capacity at constant volume $C_V$ is given by
\begin{equation}
	\label{eq:specific_heat_capacity}
	C_V = \frac{\beta}{T}\sigma_E, \ \ \sigma_E = \sqrt{\left<E^2\right> - \left<E\right>}
\end{equation}
$\sigma_E$ is the variance of $E$.

\subsection*{Two dimensional lattice} \label{sect:2by2Lattice}

From \cite{oppgavetekst} the energy in a 2D lattice with no external magnetic field is given by
\begin{equation}
	\label{eq:2D_energy}
	E = -J \sum_{<kl>}^{N}s_ks_l,
\end{equation}
where $s_k = \pm 1$ (representing the spin direction), $N$ the total number of spins and $J$ a coupling constant indicating the strength of the interaction between neighboring spins. The $<kl>$ means that we sum over the nearest neighbors.

\section{Methods}

In this report we are only going to use periodic boundary conditions, meaning the edges are neighbors. For a square peace of (stretchy) paper, this would look like first folding it into a cylinder and then into a donut-shape.

We are going to simulate a 2D lattice with periodic boundary conditions. This means that the neighbour to the right of $s_N$ takes the value of $s_0$ and the neighbour to the left of $s_0$ takes the value of $s_N$.

\subsection{Testing of algorithm}

In order to make sure our algorithm is running correctly, we want to test it. In order to do this, we are going to compare it with analytical results, namely a 2x2 lattice.

By using equation \eqref{eq:2D_energy} and testing all 16 different combinations for a 2D lattice, we have made a table (see \ref{tab:E_and_M_2D_lattice}) that shows all the possible energies and magnetizations, as well as the multiplicity of each configuration (marked as degeneracy).
\begin{table}[h]
	\input{tables/tab_E_and_M_2D_tex.txt}
	\caption{Table showing the energy, multiplicity and magnetization of different configurations of spins in a $2 \times 2$ 2D-lattice with periodic boundary conditions.}
	\label{tab:E_and_M_2D_lattice}
\end{table}
With this we can find the analytical term of the partition function ($Z$). Reading the values from table \ref{tab:E_and_M_2D_lattice} and using equation \eqref{eq:partition_function} we get:
\begin{align*}
Z &= \sum_{i = 1}^{16} \exp(-\beta E_i) \\
&= 12 + 2\exp(8\beta) + 2\exp(-8\beta) \\
&= 12 + 4\cosh(8\beta). \numberthis \label{eq:2Dpartition_function}
\end{align*}
With the partition function and the canonical ensemble through equation \eqref{eq:canonical_ensemble}, we can find a lot of useful values. With equations (\ref{eq:expected_energy}-\ref{eq:specific_heat_capacity}) we can find expected energy $\left<E\right	>$, mean absolute value of the magnetic moment $\left<|M|\right>$, susceptibility $\chi$ and specific heat capacity at constant volume $C_V$.

\section{Results}

\section{Discussion}

\section{Appendix}
\subsection{Algorithm specific optimization}

In order to make our algorithm run faster, we do some optimization. We list the optimizations we implemented here, to make our code easier to understand and as a guide for anyone who wants to do something similar.

Through table \ref{tab:E_and_M_2D_lattice}, we already know the possible energy differences ($\Delta E$) in the lattice before we start the simulation. 
\begin{itemize}
	\item $\Delta E = \pm 16$ J for the difference between 8 J and -8 J (both ways)
	\item $\Delta E = \pm 8$ J for the difference between $\pm 8$ J and 0 J (both ways)
	\item $\Delta E = 0$ J
\end{itemize}
We can thus compute and store the different values of $e^{- \beta \Delta E}$ beforehand to avoid making these computations every time we update the energy.

As mentioned above, we are going to use periodic boundary conditions. The easiest, but slow way of implementing this, is with if-tests. However we did it with a simple function (in c++),
\begin{lstlisting}
int PeriodicBoundary(int i, int limit, int add) { 
	return (i+limit+add) % (limit);
}
\end{lstlisting}
that takes the current index you are evaluating (\texttt{i}), the total size (\texttt{limit}) and the amount you want to go forward and backward (\texttt{add}). Then we sum all the arguments and take the rest, reassuring us we always arrive at the right index, or if we are at the edge, wrap back around.

\onecolumngrid
\vspace{1cm} % some extra space

\begin{thebibliography}{}
\bibitem[]{oppgavetekst} Department of Physics, Univeristy of Oslo, Fall semester 2020, Computational Physics I FYS3150/FYS4150, Project 4.
\bibitem[]{lectures2015} Morten Hjorth-Jensen, Computational Physics, Lecture Notes Fall 2015, August 2015, https://github.com/CompPhysics/ComputationalPhysics/blob/master/doc/Lectures/lectures2015.pdf.

\end{thebibliography}


\end{document}
